### Addon CLI options

Ember CLI comes with an addon command with the followin usage options:

```
ember addon <addon-name> <options...>
  Creates a new folder and runs ember init in it.
  --dry-run (Default: false)
  --verbose (Default: false)
  --blueprint (Default: addon)
  --skip-npm (Default: false)
  --skip-bower (Default: false)
  --skip-git (Default: false)
```

Note that an addon can NOT be created inside an existing application.
This is to ensure that your addon is developed and runs is isolation and doesn't `require` any application files (by accident).

### Create addon

To create a basic addon:

`ember addon <addon-name>`

Running this command should generate something like the following:

```
ember addon my-addon
version: 0.0.42
installing
  create .bowerrc
  create .editorconfig
  create tests/dummy/.jshintrc
  create .travis.yml
  create Brocfile.js
  create README.md

  create tests/dummy/app/app.js
  ... more test files

  create bower.json
  create .gitignore
  create package.json  

  ...
  create vendor/.gitkeep
  create addon/.gitkeep
  create app/.gitkeep
  create index.js

Installing packages for tooling via npmb 
Installed browser packages via Bower. 
```

### Create blueprint

To create a blueprint addon:

`ember addon <blueprint-name> --blueprint`

Creates the same structure as for the addon (currently).

For more details on blueprints, please see [[generators-and-blueprints]]

### Scenarios
The Ember CLI addons API currently supports the following scenarios:

* Performing operations on the `EmberApp` created in the consuming applications `Brocfile.js`
* Adding preprocessors to the default registry
* Providing a custom application tree to be merged with the consuming application
* Providing custom express (server) middlewares


### Discovery
Ember CLI detects the presence of an addon by inspecting each of your applications dependencies and searching their `package.json` files for the presence of `ember-addon` in the `keywords` section.

### Installation
Any addon can be installed simply via

`npm install --save-dev <package name>`

### Entry point
By default it will use standard *Node.js* require rules (see _here_ for a breakdown), but you can provide a custom entry point by specifying a `ember-addon-main` property in your `package.json`.

Example:

```json
"keywords": [
  "ember-addon"
],
"ember-addon-main": "lib/ember-addon-main.js"
```

Ember CLI will create a new instance of the class that your addon returns passing it the `Project` instance for the current project. The `Project` model has a few functions that might be useful to your addon:

* `require` - Require files or packages from consuming application
* `config` - Returns configuration for provided environment
* `resolve` - Looks up a file from project root

Example: main addon file

See the full file [here](https://github.com/rondale-sc/ember-cli-super-number/blob/9c06da653c1e82bf0f6e4b364704f86ba377605e/lib/ember-cli-super-number.js)


```javascript
// lib/ember-addon-main.js

function EmberCLISuperNumber(project) {
  this.project = project;
  this.name    = 'Ember CLI Super Number';
}

EmberCLISuperNumber.prototype.treeFor = function treeFor(name) {
  var treePath =  path.join('node_modules', 'ember-cli-super-number', name + '-addon');

  if (fs.existsSync(treePath)) {
    return unwatchedTree(treePath);
  }
};

EmberCLISuperNumber.prototype.included = function included(app) {
  this.app = app;

  this.app.import('vendor/ember-cli-super-number/styles/style.css');
};

EmberCLISuperNumber.prototype.included = function included(app) {
  this.app = app;

  this.app.import('vendor/ember-cli-super-number/styles/style.css');
};

module.exports = EmberCLISuperNumber;
```

The `unwatchedTree` function ensures that the watcher doesnâ€™t monitor changes on included files.

In the example file, we also demonstrate use of the `included` hook. This hook is called by the `EmberApp` constructor and gives access to the app as `app`. This is the perfect place to vendor css or other assets. This is especially useful when developing blueprint addons.

When the consuming application's `Brocfile.js` is processed by Ember CLI to build/serve/etc the addon's `included` function is called passing the `EmberApp` instance. 

### Merging addon trees
Currently, the following trees can be customized by the addon:

app -- addon tree will be merged with that of the application.  Here you would add custom initializers for your addon, add any app files etc. 
styles -- addon styles tree will be merged with your applications styles (app/styles/).
vendor -- addon vendor tree will be merged with your applications vendor tree (/vendor)

Merging these trees together is made quite simple with Broccoli:

```
// Brocfile.js
var mergeTrees = require('broccoli-merge-trees');

var appTree    = mergeTrees(['app', 'app-addon'], { overwrite: true });
var vendorTree = mergeTrees(['vendor', 'vendor-addon']);
``

### Publishing
Remove the `"private": true` flag from `package.json` and call `npm publish`. 
Now you can install your addon with `npm install ember-cli-<your-addon-name-here> --save-dev`.